var GW2Maps={init:function(b){if(typeof b!=="object"){return false}var c=GW2Maps.options(b),g={map:L.map(b,{minZoom:0,maxZoom:c.max_zoom,crs:L.CRS.Simple,zoomControl:c.map_controls,attributionControl:false}),layers:{},linkbox:$('<div class="linkbox" style="width: '+c.linkbox+"; height: "+c.height+';" />')};if(c.linkbox){var f=Math.random().toString().replace(/\./,""),e='<div class="table-row" style="width:'+c.width+'" />',a='<div id="c-'+f+'" class="table-cell" style="width:100%;" />',d='<div class="table-cell" />';$(b).css({width:"100%",height:c.height}).wrap(e).wrap(a);g.linkbox.insertAfter("#c-"+f+"").wrap(d)}else{$(b).css({width:c.width,height:c.height})}L.tileLayer("https://tiles.guildwars2.com/{continent_id}/{floor_id}/{z}/{x}/{y}.jpg",{errorTileUrl:c.i18n.errortile,minZoom:0,maxZoom:c.max_zoom,continuousWorld:true,continent_id:c.continent_id,floor_id:c.floor_id,attribution:c.i18n.attribution+': <a href="https://forum-en.guildwars2.com/forum/community/api/API-Documentation" target="_blank">GW2 Maps API</a>, &copy;<a href="http://www.arena.net/" target="_blank">ArenaNet</a>'}).addTo(g.map);g.layers[c.i18n.event]=L.layerGroup();g.layers[c.i18n.landmark]=L.layerGroup();g.layers[c.i18n.markers]=L.layerGroup();g.layers[c.i18n.polylines]=L.layerGroup();g.layers[c.i18n.skill]=L.layerGroup();g.layers[c.i18n.task]=L.layerGroup();g.layers[c.i18n.vista]=L.layerGroup();g.layers[c.i18n.waypoint]=L.layerGroup();g.layers[c.i18n.sector]=L.layerGroup();if(g.map.getZoom()>2){g.layers[c.i18n.marker].addTo(g.map)}if(g.map.getZoom()>3){g.layers[c.i18n.landmark].addTo(g.map);g.layers[c.i18n.skill].addTo(g.map);g.layers[c.i18n.vista].addTo(g.map);g.layers[c.i18n.waypoint].addTo(g.map)}if(g.map.getZoom()>4){g.layers[c.i18n.polylines].addTo(g.map);g.layers[c.i18n.task].addTo(g.map)}if(c.region_id&&c.map_id||g.map.getZoom()>5){g.layers[c.i18n.sector].addTo(g.map);g.layers[c.i18n.event].addTo(g.map)}if(c.map_controls){L.control.layers(null,g.layers).addTo(g.map)}if(c.polyline&&c.polyline.length>7){GW2Maps.parse_polylines(g,c)}if(c.markers&&c.markers.length>2){GW2Maps.parse_markers(g,c)}g.map.on("zoomend",function(){var h=g.map.getZoom();h>5?g.layers[c.i18n.event].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.event]);h>5?g.layers[c.i18n.sector].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.sector]);h>4?g.layers[c.i18n.polylines].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.polylines]);h>4?g.layers[c.i18n.task].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.task]);h>3?g.layers[c.i18n.landmark].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.landmark]);h>3?g.layers[c.i18n.skill].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.skill]);h>3?g.layers[c.i18n.vista].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.vista]);h>3?g.layers[c.i18n.waypoint].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.waypoint]);h>2?g.layers[c.i18n.markers].addTo(g.map):g.map.removeLayer(g.layers[c.i18n.markers])});g.map.on("click",function(h){console.log(g.map.project(h.latlng,c.max_zoom).toString())});$.ajax({url:"https://api.guildwars2.com/v1/map_floor.json?continent_id="+c.continent_id+"&floor="+c.floor_id+"&lang="+c.i18n.lang,dataType:"json",success:function(h){if(c.event_data){$.ajax({url:"https://api.guildwars2.com/v1/event_details.json?lang="+c.i18n.lang,dataType:"json",success:function(j){var i={};$.each(j.events,function(k,l){if(typeof i[l.map_id]==="undefined"){i[l.map_id]={}}i[l.map_id][k]=l});GW2Maps.parse_response(g,c,h,i)}})}else{GW2Maps.parse_response(g,c,h,false)}}}).fail(function(){c.region_id=false;GW2Maps.parse_response(g,c,{texture_dims:c.continent_id===1?[32768,32768]:[16384,16384],regions:[]},{})});return g},parse_response:function(h,b,c,g){var e,f,d,a=function(i){return h.map.unproject(i,b.max_zoom)};if(c.clamped_view){f=c.clamped_view;e=new L.LatLngBounds(a([f[0][0],f[1][1]]),a([f[1][0],f[0][1]])).pad(0.2)}else{if(b.region_id&&b.map_id){f=c.regions[b.region_id].maps[b.map_id].continent_rect;e=new L.LatLngBounds(a([f[0][0],f[1][1]]),a([f[1][0],f[0][1]])).pad(0.4)}else{e=new L.LatLngBounds(a([0,c.texture_dims[1]]),a([c.texture_dims[0],0])).pad(0.1)}}h.map.setMaxBounds(e).fitBounds(e);if(b.region_id&&b.map_id){d=typeof g[b.map_id]!=="undefined"?g[b.map_id]:false;GW2Maps.parse_map(h,b,c.regions[b.region_id].maps[b.map_id],d)}else{$.each(c.regions,function(){$.each(this.maps,function(j){GW2Maps.parse_map(h,b,this,typeof g[j]!=="undefined"?g[j]:false)})})}},parse_map:function(g,b,e,f){var d={task:[],event:[],landmark:[],skill:[],vista:[],waypoint:[],sector:[]},c={task:[],event:[],landmark:[],skill:[],vista:[],waypoint:[],sector:[]},a=function(i,h,j){return[(i[0][0]+(i[1][0]-i[0][0])*(j[0]-h[0][0])/(h[1][0]-h[0][0])),(i[0][1]+(i[1][1]-i[0][1])*(1-(j[1]-h[0][1])/(h[1][1]-h[0][1])))]};$.each(e.points_of_interest,function(){if(this.type=="waypoint"){c.waypoint.push(this.name);d.waypoint.push({id:this.poi_id,type:this.type,coords:this.coord,title:this.name,text:this.name,popup:this.name+"<br />id:"+this.poi_id})}if(this.type=="landmark"){c.landmark.push(this.name);d.landmark.push({id:this.poi_id,type:this.type,coords:this.coord,title:this.name,text:this.name,popup:'<a href="'+b.i18n.wiki+encodeURIComponent(this.name)+'" target="_blank">'+this.name+"</a><br />id:"+this.poi_id})}if(this.type=="vista"){c.vista.push(this.poi_id);d.vista.push({type:this.type,coords:this.coord,title:"id:"+this.poi_id,text:this.name+" "+this.poi_id,popup:"id:"+this.poi_id})}});$.each(e.tasks,function(){c.task.push(this.level);d.task.push({id:this.task_id,type:"task",coords:this.coord,title:this.objective+" ("+this.level+")",text:"("+this.level+") "+this.objective,popup:'<a href="'+b.i18n.wiki+encodeURIComponent(this.objective.replace(/\.$/,""))+'" target="_blank">'+this.objective+"</a> ("+this.level+")<br />id:"+this.task_id})});$.each(e.skill_challenges,function(){c.skill.push(this.coord.toString());d.skill.push({id:null,type:"skill",coords:this.coord,title:this.coord.toString(),text:this.name+" "+this.coord.toString(),popup:this.name+" "+this.coord.toString()})});$.each(e.sectors,function(){c.sector.push(this.name);d.sector.push({id:this.sector_id,type:"sector",coords:this.coord,title:this.name+", id:"+this.sector_id,icon_text:this.name,icon_text_class:"sector_text",text:this.name,popup:'<a href="'+b.i18n.wiki+encodeURIComponent(this.name)+'" target="_blank">'+this.name+"</a><br />id:"+this.sector_id})});if(f){$.each(f,function(h){c.event.push(this.level);d.event.push({id:h,type:"event",coords:a(e.continent_rect,e.map_rect,this.location.center),title:this.name+" ("+this.level+")",text:"("+this.level+") "+this.name,popup:'<a href="'+b.i18n.wiki+encodeURIComponent(this.name.replace(/\.$/,""))+'" target="_blank">'+this.name+"</a> ("+this.level+")<br />id:"+h})})}if(b.linkbox){g.linkbox.append('<div class="header">'+e.name+"</div>")}$.each(d,function(h,j){phpjs.array_multisort(c[h],"SORT_ASC",j);if(j.length>0){if(b.linkbox){g.linkbox.append('<div class="header sub">'+b.i18n[h]+"</div>")}$.each(j,function(){GW2Maps.parse_point(g,b,this)})}})},parse_point:function(g,c,a){var f=function(h){var i=g.map.unproject(h.data.coords,c.max_zoom);g.map.panTo(i);if(h.data.text){L.popup({offset:new L.Point(0,-5)}).setLatLng(i).setContent(h.data.text).openOn(g.map)}},d=c.i18n["icon_"+a.type],e;if(a.type==="sector"){e=L.divIcon({iconSize:[300,30],className:a.icon_text_class,html:a.icon_text})}else{if(a.type==="event"){e=L.icon({iconUrl:d.link,iconSize:d.size,popupAnchor:[0,-d.size[1]/2]})}else{e=L.icon({iconUrl:d.link,iconSize:d.size,popupAnchor:[0,-d.size[1]/2]})}}var b=L.marker(g.map.unproject(a.coords,c.max_zoom),{title:a.title,icon:e});if(a.popup){b.bindPopup(a.popup)}g.layers[c.i18n[a.type]].addLayer(b);if(c.linkbox){g.linkbox.append($("<div>"+(d?'<img src="'+d.link+'" style="width:16px; height:16px" />':"")+" "+a.text+"</div>").on("click",null,{coords:a.coords,text:a.popup},f))}if(c.poi_id&&a.id===c.poi_id&&c.poi_type&&a.type===c.poi_type){f({data:{coords:a.coords,text:a.popup}});g.map.setZoom(c.max_zoom)}},parse_polylines:function(c,b){var a=b.polyline.split(";");$.each(a,function(){var j=this.split(" "),d=[],i={};$.each(j,function(n,o){if(o.match(/\d{1,5},\d{1,5}/)){var l=o.split(",");d.push(c.map.unproject(l,b.max_zoom))}if(o.match(/(color|width|opacity|style|type)=(([0-9a-f]{3}){1,2}|\d{1,3}|(arrow|marker|dash))/i)){var m=o.toLowerCase().split("=");i[m[0]]=m[1]}});var e=typeof i.color!=="undefined"?"#"+i.color:"#ffe500",h=typeof i.width!=="undefined"?phpjs.intval(i.width):3,f=typeof i.opacity!=="undefined"?phpjs.intval(i.opacity)/100:0.8,k=i.style==="dash"?"30,15,10,15":"";d=L.polyline(d,{color:e,weight:h,opacity:f,dashArray:k});c.layers[b.i18n.polylines].addLayer(d);if(typeof i.type!=="undefined"){var g=[];if(i.type==="arrow"){g.push({offset:50,repeat:"150px",symbol:new L.Symbol.ArrowHead({pixelSize:15,polygon:false,pathOptions:{stroke:true,color:e,weight:h,opacity:f}})})}if(i.type==="marker"){g.push({offset:0,repeat:"100%",symbol:new L.Symbol.Marker()})}c.layers[b.i18n.polylines].addLayer(L.polylineDecorator(d,{patterns:g}))}})},parse_markers:function(c,b){var a=b.markers.split(";");$.each(a,function(){var d=this.split(" ");$.each(d,function(g,h){if(h.match(/\d{1,5},\d{1,5}/)){var e=h.split(","),f=L.marker(c.map.unproject(e,b.max_zoom)).addTo(c.map);c.layers[b.i18n.markers].addLayer(f)}})})},options:function(c){var d={};$.each(c.attributes,function(){if(this.name.match(/^data-/)){d[jQuery.camelCase(this.name.substr(5))]=(this.name==="data-polyline"||this.name==="data-markers")?this.value:phpjs.intval(this.value)}});var e=["en","de","en","es","fr"],b=[false,"landmark","sector","skill","task","vista","waypoint"],a=typeof d.continent_id==="number"&&d.continent_id>=1&&d.continent_id<=2?d.continent_id:1;return{max_zoom:a==1?7:6,continent_id:a,floor_id:typeof d.floor_id==="number"?d.floor_id:2,region_id:typeof d.region_id==="number"&&d.region_id>0?d.region_id:false,map_id:typeof d.map_id==="number"&&d.map_id>0?d.map_id:false,poi_id:typeof d.poi_id==="number"&&d.poi_id>0?d.poi_id:false,poi_type:typeof d.poi_type==="number"&&d.poi_type>0&&d.poi_type<=6?b[d.poi_type]:false,width:typeof d.width==="number"&&d.width>0?d.width+(d.w_percent==true?"%":"px"):"800px",height:typeof d.height==="number"&&d.height>0?d.height+(d.h_percent==true?"%":"px"):"450px",map_controls:d.disable_controls!=true,event_data:d.disable_eventdata!=true,linkbox:typeof d.linkbox==="number"&&d.linkbox>=100?d.linkbox+"px":false,polyline:d.polyline&&d.polyline.length>7?d.polyline:false,markers:d.markers&&d.markers.length>2?d.markers:false,i18n:typeof d.language==="number"&&d.language>=1&&d.language<=4?GW2Maps.i18n[e[d.language]]:GW2Maps.i18n[e[0]]}},i18n:{de:{lang:"de",wiki:"//wiki-de.guildwars2.com/wiki/",icon_event:{link:"//wiki-de.guildwars2.com/images/7/7a/Event_Angriff_Icon.png",size:[24,24]},icon_landmark:{link:"//wiki-de.guildwars2.com/images/0/0f/Sehenswürdigkeit_Icon.png",size:[16,16]},icon_skill:{link:"//wiki-de.guildwars2.com/images/c/c3/Fertigkeitspunkt_Icon.png",size:[20,20]},icon_task:{link:"//wiki-de.guildwars2.com/images/b/b7/Aufgabe_Icon.png",size:[20,20]},icon_vista:{link:"//wiki-de.guildwars2.com/images/9/9f/Aussichtspunkt_Icon.png",size:[20,20]},icon_waypoint:{link:"//wiki-de.guildwars2.com/images/d/df/Wegmarke_Icon.png",size:[24,24]},errortile:"//wiki-de.guildwars2.com/images/6/6f/Kartenhintergrund.png",event:"Events",landmark:"Sehenswürdigkeiten",markers:"Marker",polylines:"Polylinien",sector:"Zonen",skill:"Fertigkeitspunkte",task:"Aufgaben",vista:"Aussichtspunkte",waypoint:"Wegpunkte",attribution:"Kartendaten und -bilder"},en:{lang:"en",wiki:"//wiki.guildwars2.com/wiki/",icon_event:{link:"//wiki-de.guildwars2.com/images/7/7a/Event_Angriff_Icon.png",size:[24,24]},icon_landmark:{link:"//wiki.guildwars2.com/images/f/fb/Point_of_interest.png",size:[20,20]},icon_skill:{link:"//wiki.guildwars2.com/images/8/84/Skill_point.png",size:[20,20]},icon_task:{link:"//wiki.guildwars2.com/images/f/f8/Complete_heart_(map_icon).png",size:[20,20]},icon_vista:{link:"//wiki.guildwars2.com/images/d/d9/Vista.png",size:[20,20]},icon_waypoint:{link:"//wiki.guildwars2.com/images/d/d2/Waypoint_(map_icon).png",size:[20,20]},errortile:"//wiki-de.guildwars2.com/images/6/6f/Kartenhintergrund.png",event:"Events",landmark:"Points of Interest",markers:"Markers",polylines:"Polylines",sector:"Sector Names",skill:"Skill Challenges",task:"Tasks",vista:"Vistas",waypoint:"Waypoints",attribution:"Map data and imagery"},es:{lang:"es",wiki:"//wiki-es.guildwars2.com/wiki/",icon_event:{link:"//wiki-de.guildwars2.com/images/7/7a/Event_Angriff_Icon.png",size:[24,24]},icon_landmark:{link:"//wiki.guildwars2.com/images/f/fb/Point_of_interest.png",size:[20,20]},icon_skill:{link:"//wiki.guildwars2.com/images/8/84/Skill_point.png",size:[20,20]},icon_task:{link:"//wiki.guildwars2.com/images/f/f8/Complete_heart_(map_icon).png",size:[20,20]},icon_vista:{link:"//wiki.guildwars2.com/images/d/d9/Vista.png",size:[20,20]},icon_waypoint:{link:"//wiki.guildwars2.com/images/d/d2/Waypoint_(map_icon).png",size:[20,20]},errortile:"//wiki-de.guildwars2.com/images/6/6f/Kartenhintergrund.png",event:"event-es",landmark:"poi-es",markers:"markers-es",polylines:"polyline-es",sector:"sector-es",skill:"skill-es",task:"task-es",vista:"vista-es",waypoint:"waypoint-es",attribution:"attribution-es"},fr:{lang:"fr",wiki:"//wiki-fr.guildwars2.com/wiki/",icon_event:{link:"//wiki-de.guildwars2.com/images/7/7a/Event_Angriff_Icon.png",size:[24,24]},icon_landmark:{link:"//wiki-fr.guildwars2.com/images/d/d2/Icône_site_remarquable_découvert.png",size:[20,20]},icon_skill:{link:"//wiki-fr.guildwars2.com/images/5/5c/Progression_défi.png",size:[20,20]},icon_task:{link:"//wiki-fr.guildwars2.com/images/a/af/Icône_coeur_plein.png",size:[20,20]},icon_vista:{link:"//wiki-fr.guildwars2.com/images/8/82/Icône_panorama.png",size:[20,20]},icon_waypoint:{link:"//wiki-fr.guildwars2.com/images/5/56/Progression_passage.png",size:[20,20]},errortile:"//wiki-de.guildwars2.com/images/6/6f/Kartenhintergrund.png",event:"event-fr",landmark:"Sites remarquables",markers:"markers-fr",polylines:"polyline-fr",sector:"Secteurs",skill:"Défis de compétences",task:"Cœurs",vista:"Panoramas",waypoint:"Points de passage",attribution:"attribution-fr"}}};var phpjs={intval:function(b,d){var a,c=typeof(b);if(c==="boolean"){return +b}else{if(c==="string"){a=parseInt(b,d||10);return(isNaN(a)||!isFinite(a))?0:a}else{if(c==="number"&&isFinite(b)){return b|0}else{return 0}}}},parse_url:function(g,j){var h,k=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],l=(this.php_js&&this.php_js.ini)||{},f=(l["phpjs.parse_url.mode"]&&l["phpjs.parse_url.mode"].local_value)||"php",b={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};var d=b[f].exec(g),c={},e=14;while(e--){if(d[e]){c[k[e]]=d[e]}}if(j){return c[j.replace("PHP_URL_","").toLowerCase()]}if(f!=="php"){var a=(l["phpjs.parse_url.queryKey"]&&l["phpjs.parse_url.queryKey"].local_value)||"queryKey";b=/(?:^|&)([^&=]*)=?([^&]*)/g;c[a]={};h=c[k[12]]||"";h.replace(b,function(m,i,n){if(i){c[a][i]=n}})}delete c.source;return c},array_multisort:function(b){var h={SORT_REGULAR:16,SORT_NUMERIC:17,SORT_STRING:18,SORT_ASC:32,SORT_DESC:40},e=0,D=[[]],s=[[]],B=[0],A=0,z=0,y,w="",u=0,a=[],p=0,v=null,C=[],n=[],c=[],x=[],f=0,d=function(){return C.shift()},m=[[function(i,g){n.push(i>g?1:(i<g?-1:0));return i>g?1:(i<g?-1:0)},function(i,g){n.push(g>i?1:(g<i?-1:0));return g>i?1:(g<i?-1:0)}],[function(i,g){n.push(i-g);return i-g},function(i,g){n.push(g-i);return g-i}],[function(i,g){n.push((i+"")>(g+"")?1:((i+"")<(g+"")?-1:0));return(i+"")>(g+"")?1:((i+"")<(g+"")?-1:0)},function(i,g){n.push((g+"")>(i+"")?1:((g+"")<(i+"")?-1:0));return(g+"")>(i+"")?1:((g+"")<(i+"")?-1:0)}]];if(Object.prototype.toString.call(b)==="[object Array]"){D[0]=b}else{if(b&&typeof b==="object"){for(z in b){if(b.hasOwnProperty(z)){s[0].push(z);D[0].push(b[z])}}}else{return false}}var t=D[0].length,o=[0,t];for(y=1;y<arguments.length;y++){if(Object.prototype.toString.call(arguments[y])==="[object Array]"){D[y]=arguments[y];B[y]=0;if(arguments[y].length!==t){return false}}else{if(arguments[y]&&typeof arguments[y]==="object"){s[y]=[];D[y]=[];B[y]=0;for(z in arguments[y]){if(arguments[y].hasOwnProperty(z)){s[y].push(z);D[y].push(arguments[y][z])}}if(D[y].length!==t){return false}}else{if(typeof arguments[y]==="string"){var r=B.pop();if(typeof h[arguments[y]]==="undefined"||((((h[arguments[y]])>>>4)&(r>>>4))>0)){return false}B.push(r+h[arguments[y]])}else{return false}}}}for(z=0;z!==t;z++){a.push(true)}for(z in D){if(D.hasOwnProperty(z)){c=[];x=[];f=0;C=[];n=[];if(o.length===0){if(Object.prototype.toString.call(arguments[z])==="[object Array]"){arguments[z]=D[z]}else{for(w in arguments[z]){if(arguments[z].hasOwnProperty(w)){delete arguments[z][w]}}e=D[z].length;for(y=0,p=0;y<e;y++){p=s[z][y];arguments[z][p]=D[z][y]}}delete D[z];delete s[z];continue}var q=m[(B[z]&3)][((B[z]&8)>0)?1:0];for(u=0;u!==o.length;u+=2){x=D[z].slice(o[u],o[u+1]+1);x.sort(q);c[u]=[].concat(n);f=o[u];for(A in x){if(x.hasOwnProperty(A)){D[z][f]=x[A];f++}}}q=d;for(y in D){if(D.hasOwnProperty(y)){if(D[y]===D[z]){continue}for(u=0;u!==o.length;u+=2){x=D[y].slice(o[u],o[u+1]+1);C=[].concat(c[u]);x.sort(q);f=o[u];for(A in x){if(x.hasOwnProperty(A)){D[y][f]=x[A];f++}}}}}for(y in s){if(s.hasOwnProperty(y)){for(u=0;u!==o.length;u+=2){x=s[y].slice(o[u],o[u+1]+1);C=[].concat(c[u]);x.sort(q);f=o[u];for(A in x){if(x.hasOwnProperty(A)){s[y][f]=x[A];f++}}}}}v=null;o=[];for(y in D[z]){if(D[z].hasOwnProperty(y)){if(!a[y]){if((o.length&1)){o.push(y-1)}v=null;continue}if(!(o.length&1)){if(v!==null){if(D[z][y]===v){o.push(y-1)}else{a[y]=false}}v=D[z][y]}else{if(D[z][y]!==v){o.push(y-1);v=D[z][y]}}}}if(o.length&1){o.push(y)}if(Object.prototype.toString.call(arguments[z])==="[object Array]"){arguments[z]=D[z]}else{for(y in arguments[z]){if(arguments[z].hasOwnProperty(y)){delete arguments[z][y]}}e=D[z].length;for(y=0,p=0;y<e;y++){p=s[z][y];arguments[z][p]=D[z][y]}}delete D[z];delete s[z]}}return true}};L.GeometryUtil={computeAngle:function(d,c){return(Math.atan2(c.y-d.y,c.x-d.x)*180/Math.PI)+90},getPointPathPixelLength:function(g){var e=g.length;if(e<2){return 0}var f=0;var c=g[0],d;for(var b=1,a=g.length;b<a;b++){f+=c.distanceTo(d=g[b]);c=d}return f},getPixelLength:function(c,a){var f=(c instanceof L.Polyline)?c.getLatLngs():c;var h=f.length;if(h<2){return 0}var e=0;var g=a.latLngToLayerPoint(f[0]),j;for(var d=1,b=f.length;d<b;d++){e+=g.distanceTo(j=a.latLngToLayerPoint(f[d]));g=j}return e},projectPatternOnPath:function(h,e,c,g){var a=[],d,b;for(d=0,b=h.length;d<b;d++){a[d]=g.latLngToLayerPoint(h[d])}var f=this.projectPatternOnPointPath(a,e,c);for(d=0,b=f.length;d<b;d++){f[d].latLng=g.layerPointToLatLng(f[d].pt)}return f},projectPatternOnPointPath:function(h,d,b){var a=[];var f=L.GeometryUtil.getPointPathPixelLength(h)*b;var e=L.GeometryUtil.interpolateOnPointPath(h,d);a.push(e);if(b>0){var c=h;c=c.slice(e.predecessor);c[0]=e.pt;var g=L.GeometryUtil.getPointPathPixelLength(c);while(f<=g){e=L.GeometryUtil.interpolateOnPointPath(c,f/g);a.push(e);c=c.slice(e.predecessor);c[0]=e.pt;g=L.GeometryUtil.getPointPathPixelLength(c)}}return a},interpolateOnPointPath:function(n,f){var l=n.length;if(l<2){return null}if(f<=0){return{pt:n[0],predecessor:0,heading:L.GeometryUtil.computeAngle(n[0],n[1])}}if(f>=1){return{pt:n[l-1],predecessor:l-1,heading:L.GeometryUtil.computeAngle(n[l-2],n[l-1])}}if(l==2){return{pt:L.GeometryUtil.interpolateBetweenPoints(n[0],n[1],f),predecessor:0,heading:L.GeometryUtil.computeAngle(n[0],n[1])}}var k,j,g,e,h=0,m=L.GeometryUtil.getPointPathPixelLength(n);k=j=n[0];g=e=0;var c=1;for(;c<l&&e<f;c++){k=j;g=e;j=n[c];h+=k.distanceTo(j);e=h/m}var d=(f-g)/(e-g);return{pt:L.GeometryUtil.interpolateBetweenPoints(k,j,d),predecessor:c-2,heading:L.GeometryUtil.computeAngle(k,j)}},interpolateBetweenPoints:function(b,a,c){return a.x!=b.x?new L.Point((b.x*(1-c))+(c*a.x),(b.y*(1-c))+(c*a.y)):new L.Point(b.x,b.y+(a.y-b.y)*c)}};L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{bestTransform:L.DomUtil.testProp(["transform","WebkitTransform","msTransform","MozTransform","OTransform"])},_setPos:function(e){L.Marker.prototype._setPos.call(this,e);var c=" rotate("+this.options.angle+"deg)";if(L.RotatedMarker.bestTransform){this._icon.style[L.RotatedMarker.bestTransform]+=c}else{if(L.Browser.ie){var a=this.options.angle*L.LatLng.DEG_TO_RAD,b=Math.cos(a),d=Math.sin(a);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+b+", M12="+(-d)+", M21="+d+", M22="+b+")"}}}});L.Symbol=L.Symbol||{};L.Symbol.Dash=L.Class.extend({isZoomDependant:true,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=false},buildSymbol:function(d,h,g){var f=this.options;if(f.pixelSize<=1){return new L.Polyline([d.latLng,d.latLng],f.pathOptions)}var j=g.project(d.latLng);var i=(-(d.heading-90))*L.LatLng.DEG_TO_RAD;var e=new L.Point(j.x+f.pixelSize*Math.cos(i+Math.PI)/2,j.y+f.pixelSize*Math.sin(i)/2);var c=j.add(j.subtract(e));return new L.Polyline([g.unproject(e),g.unproject(c)],f.pathOptions)}});L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:true,options:{polygon:true,pixelSize:10,headAngle:60,pathOptions:{stroke:false,weight:2}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=false},buildSymbol:function(a,e,d){var b=this.options;var c;if(b.polygon){c=new L.Polygon(this._buildArrowPath(a,d),b.pathOptions)}else{c=new L.Polyline(this._buildArrowPath(a,d),b.pathOptions)}return c},_buildArrowPath:function(f,b){var d=b.project(f.latLng);var g=(-(f.heading-90))*L.LatLng.DEG_TO_RAD;var e=this.options.headAngle/2*L.LatLng.DEG_TO_RAD;var i=g+e,h=g-e;var c=new L.Point(d.x-this.options.pixelSize*Math.cos(i),d.y+this.options.pixelSize*Math.sin(i)),a=new L.Point(d.x-this.options.pixelSize*Math.cos(h),d.y+this.options.pixelSize*Math.sin(h));return[b.unproject(c),f.latLng,b.unproject(a)]}});L.Symbol.Marker=L.Class.extend({isZoomDependant:false,options:{markerOptions:{},rotate:false},initialize:function(a){L.Util.setOptions(this,a);this.options.markerOptions.clickable=false;this.options.markerOptions.draggable=false;this.isZoomDependant=(L.Browser.ie&&this.options.rotate)},buildSymbol:function(a){if(!this.options.rotate){return new L.Marker(a.latLng,this.options.markerOptions)}else{this.options.markerOptions.angle=a.heading;return new L.RotatedMarker(a.latLng,this.options.markerOptions)}}});L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(a,b){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,b);this._polyline=a;this._directionPointCache=[];this._initPatterns()},_initPatterns:function(){this._directionPointCache=[];this._isZoomDependant=false;this._patterns=[];var b;for(var a=0;a<this.options.patterns.length;a++){b=this._parsePatternDef(this.options.patterns[a]);this._patterns.push(b);this._isZoomDependant=this._isZoomDependant||b.isOffsetInPixels||b.isRepeatInPixels||b.symbolFactory.isZoomDependant}},setPatterns:function(a){this.options.patterns=a;this._initPatterns();this._softRedraw()},_parsePatternDef:function(a){var b={cache:[],symbolFactory:a.symbol,isOffsetInPixels:false,isRepeatInPixels:false};if(typeof a.offset==="string"&&a.offset.indexOf("%")!=-1){b.offset=parseFloat(a.offset)/100}else{b.offset=parseFloat(a.offset);b.isOffsetInPixels=(b.offset>0)}if(typeof a.repeat==="string"&&a.repeat.indexOf("%")!=-1){b.repeat=parseFloat(a.repeat)/100}else{b.repeat=parseFloat(a.repeat);b.isRepeatInPixels=(b.repeat>0)}return(b)},onAdd:function(a){this._map=a;this._draw();if(this._isZoomDependant){this._map.on("zoomend",this._softRedraw,this)}},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this);L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(c,b){var d=[];for(var e=0,a=b.length;e<a;e++){d.push(c.buildSymbol(b[e],this._latLngs,this._map,e,a))}return d},_getDirectionPoints:function(c){var e=c.cache[this._map.getZoom()];if(typeof e!="undefined"){return e}this._latLngs=(this._polyline instanceof L.Polyline)?this._polyline.getLatLngs():this._polyline;if(this._latLngs.length<2){return[]}if(this._polyline instanceof L.Polygon){this._latLngs.push(this._latLngs[0])}var d,b,a=null;if(c.isOffsetInPixels){a=L.GeometryUtil.getPixelLength(this._latLngs,this._map);d=c.offset/a}else{d=c.offset}if(c.isRepeatInPixels){a=(a!=null)?a:L.GeometryUtil.getPixelLength(this._latLngs,this._map);b=c.repeat/a}else{b=c.repeat}e=L.GeometryUtil.projectPatternOnPath(this._latLngs,d,b,this._map);c.cache[this._map.getZoom()]=e;return e},redraw:function(){this._redraw(true)},_softRedraw:function(){this._redraw(false)},_redraw:function(b){this.clearLayers();if(b){for(var a=0;a<this._patterns.length;a++){this._patterns[a].cache=[]}}this._draw()},_drawPattern:function(d){var a=this._getDirectionPoints(d);var b=this._buildSymbols(d.symbolFactory,a);for(var c=0;c<b.length;c++){this.addLayer(b[c])}},_draw:function(){for(var a=0;a<this._patterns.length;a++){this._drawPattern(this._patterns[a])}}});L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)};